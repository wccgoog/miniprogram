function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}function MD5(e){return e?md5(e):""}function encode$1(e){return base64.encode(e,!1)}function decode$1(e){return base64.decode(e)}function checkEmptyArgument(e){return e.length&&this.checkId(e[0])}function checkId(e){return e&&"string"==typeof e}function getRandomStr(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],a=0;a<Number(e);a++)t+=n[Math.round(Math.random()*(n.length-1))];return t}function isNumber(e){return!Number.isNaN(parseInt(e,10))}function compareVersion(e,t){for(var n=String(e).split("."),a=String(t).split("."),r=0;r<Math.max(n.length,a.length);r++){var i=parseInt(n[r]||0,10),o=parseInt(a[r]||0,10);if(i>o)return 1;if(i<o)return-1}return 0}function checkMD5(e,t){try{return e===md5(t)}catch(e){return!1}}function urequest(e){return alipay().my().httpRequest(e)}function Looper(){}function send(e,t,n){if(RequestHelper.getInstance().isParamsValid(e)){var a=RequestHelper.getInstance().buildSendContent(e);requestQueue.getInstance().send(a,t,n)}}function sendAll(){Header.getInstance().isLoaded()?(send(constants.REQUEST_TYPE_SESSION_HALF),send(constants.REQUEST_TYPE_SESSION_CLOSE),send(constants.REQUEST_TYPE_EVENT)):setTimeout(sendAll,100)}function UmengAnalysisLib(){this._inited=!1,this._resumed=!1,this._preLastSendTime=0}var alipay=function(){function e(){this.my=function(){return n||require("@alipay/af-appx").bridge||{}},this.setMy=function(e){n=e}}var t=null,n=null;return function(){return t||(t=new e),t}}(),BuildTarget={ALIPAY:"alipay",QUICKAPP:"quickapp",TARGET:"alipay"},BuildTarget_1=BuildTarget,storage={set:alipay().my().setStorage,get:alipay().my().getStorage,remove:alipay().my().removeStorage},ustorage={set:function(e,t,n,a){var r={key:e,success:function(e){"function"==typeof n&&n(e)},fail:function(e,t){"function"==typeof a&&a(e,t)}};r.data=t,storage.set(r)},get:function(e,t,n){storage.get({key:e,success:function(e){"function"==typeof t&&t(e.data)},fail:function(e,t){"function"==typeof n&&n(e,t)}})},remove:function(e,t,n){storage.remove({key:e,success:function(){"function"==typeof t&&t(!0)},fail:function(){"function"==typeof n&&n(!1)}})}},jsonUtil={stringify:function(e){if(e)try{return JSON.stringify(e)}catch(e){}return""},parse:function(e){if(e)try{return JSON.parse(e)}catch(e){}return null},parseToArray:function(e){if(e)try{return JSON.parse(e)}catch(e){}return[]}},ulog=function(){function e(){this.setDebug=function(e){n=e},this.d=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]),console.debug.apply(console,arguments)}catch(e){}},this.i=function(){try{if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]),console.info.apply(console,arguments)}catch(e){}}catch(e){}},this.e=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]),console.error.apply(console,arguments)}catch(e){}},this.w=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]),console.warn.apply(console,arguments)}catch(e){}},this.v=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]),console.log.apply(console,arguments)}catch(e){}},this.t=function(){if(n)try{console.table.apply(console,arguments)}catch(e){}},this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]),console.info.apply(console,arguments)}catch(e){}},this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]="[umeng] -- "+arguments[0]),console.error.apply(console,arguments)}catch(e){}}}var t=null,n=!1;return function(){return null===t&&(t=new e),t}}(),cache=function(){function e(){this.load=function(e){a?(ustorage.remove(n),e()):ustorage.get(n,function(t){ustorage.remove(n),a=jsonUtil.parse(t)||{},r=!0,e()})},this.save=function(){a&&ustorage.set(n,jsonUtil.stringify(a),null,function(e,t){ulog().e("cache save failed: ",t,e)})},this.set=function(e,t){a&&(a[e]=t)},this.get=function(e){return(a||{})[e]},this.remove=function(e){a&&a[e]&&delete a[e]},this.clear=function(){a=null},this.has=function(e){return!!this.get(e)},this.isLoaded=function(){return r}}var t=null,n="umeng_cache",a=null,r=!1;return function(){return t||(t=new e),t}}(),PRE_PAGE_KEY="page_",PageController=function(){this._pagelist=[],this._currentPage={},this.hasTracked=!1};PageController.prototype={startPage:function(e){e&&!this.hasTracked&&(this._currentPage={ts:Date.now(),page_name:e},this.hasTracked=!0)},endPage:function(e,t){if(this.hasTracked&&e&&t&&this._currentPage&&t===this._currentPage.page_name){var n=Date.now()-this._currentPage.ts;this._currentPage.duration=Math.abs(n),this._pagelist=this._pagelist.concat(this._currentPage),this._currentPage=null,this.savePages(e),this.hasTracked=!1}},savePages:function(e){e&&this._pagelist.length>0&&this.updateStorage(PRE_PAGE_KEY+e,this._pagelist)},getPages:function(e){var t=cache().get(PRE_PAGE_KEY+e),n=jsonUtil.parseToArray(t).concat(this._pagelist);return this.clear(e),n},updateStorage:function(e,t){if(Array.isArray(t)&&t.length>0){var n=cache().get(e);t=jsonUtil.parseToArray(n).concat(t),cache().set(e,jsonUtil.stringify(t)),this._pagelist.length=0}},clear:function(e){cache().remove(PRE_PAGE_KEY+e),this._pagelist=[]}};var LOG_SEND_HOST_PRODUCT="https://ulogs.umeng.com/mpp_logs",SDK_UPDATE_HOST_PRODUCT="https://s.cnzz.com",logSendUrl=LOG_SEND_HOST_PRODUCT,sdkUpdateUrl=SDK_UPDATE_HOST_PRODUCT,constants={NO_SEND_REQUESTS_KEY:"no_send_reqs",SESSION_INTERVAL:0,LOG_URL:logSendUrl,EVENT_PREFIX_KEY:"ekv_",HALF_SESSION_PREFIX_KEY:"halfSession_",CLOSE_SESSION_PREFIX_KEY:"closeSession_",REQUEST_TYPE_SESSION_HALF:1,REQUEST_TYPE_SESSION_CLOSE:2,REQUEST_TYPE_EVENT:3,DEBUG:!0,DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",EVENT_SEND_MIN_INTERVAL:5,EVENT_SEND_MAX_INTERVAL:86400,EVENT_LAST_SEND_TIME_KEY:"last_send_time",REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT_KEY:"imprint",DOWNLOAD_FILE_FIRST_CACHE:"hot_update_first",DOWNLOAD_FILE_SECOND_CACHE:"hot_update_second",SDK_UPDATE_SERVER_ADDRESS:sdkUpdateUrl+"/sdk/alipay",SDK_UPDATE_LOCAL_STORAGE_PATH:"internal://files/umengsdk/",SDK_CODE:"umeng_sdk_cache",SDK_INFO:"umeng_sdk_info",SEED_VERSION:"1.0.0",IMPL_VERSION:"1.0.0",ALIPAY_AVAILABLE:"10.1.52",ALIPAYID_EMPTY_FLAGE:"alipay_id_empty_",ALIPAY_FAKE_ID:"alipay_fake_id"},commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},md5=createCommonjsModule(function(e){!function(t){function n(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function a(e,t){return e<<t|e>>>32-t}function r(e,t,r,i,o,s){return n(a(n(n(t,e),n(i,s)),o),r)}function i(e,t,n,a,i,o,s){return r(t&n|~t&a,e,t,i,o,s)}function o(e,t,n,a,i,o,s){return r(t&a|n&~a,e,t,i,o,s)}function s(e,t,n,a,i,o,s){return r(t^n^a,e,t,i,o,s)}function c(e,t,n,a,i,o,s){return r(n^(t|~a),e,t,i,o,s)}function u(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var a,r,u,f,_,E=1732584193,l=-271733879,d=-1732584194,g=271733878;for(a=0;a<e.length;a+=16)r=E,u=l,f=d,_=g,l=c(l=c(l=c(l=c(l=s(l=s(l=s(l=s(l=o(l=o(l=o(l=o(l=i(l=i(l=i(l=i(l,d=i(d,g=i(g,E=i(E,l,d,g,e[a],7,-680876936),l,d,e[a+1],12,-389564586),E,l,e[a+2],17,606105819),g,E,e[a+3],22,-1044525330),d=i(d,g=i(g,E=i(E,l,d,g,e[a+4],7,-176418897),l,d,e[a+5],12,1200080426),E,l,e[a+6],17,-1473231341),g,E,e[a+7],22,-45705983),d=i(d,g=i(g,E=i(E,l,d,g,e[a+8],7,1770035416),l,d,e[a+9],12,-1958414417),E,l,e[a+10],17,-42063),g,E,e[a+11],22,-1990404162),d=i(d,g=i(g,E=i(E,l,d,g,e[a+12],7,1804603682),l,d,e[a+13],12,-40341101),E,l,e[a+14],17,-1502002290),g,E,e[a+15],22,1236535329),d=o(d,g=o(g,E=o(E,l,d,g,e[a+1],5,-165796510),l,d,e[a+6],9,-1069501632),E,l,e[a+11],14,643717713),g,E,e[a],20,-373897302),d=o(d,g=o(g,E=o(E,l,d,g,e[a+5],5,-701558691),l,d,e[a+10],9,38016083),E,l,e[a+15],14,-660478335),g,E,e[a+4],20,-405537848),d=o(d,g=o(g,E=o(E,l,d,g,e[a+9],5,568446438),l,d,e[a+14],9,-1019803690),E,l,e[a+3],14,-187363961),g,E,e[a+8],20,1163531501),d=o(d,g=o(g,E=o(E,l,d,g,e[a+13],5,-1444681467),l,d,e[a+2],9,-51403784),E,l,e[a+7],14,1735328473),g,E,e[a+12],20,-1926607734),d=s(d,g=s(g,E=s(E,l,d,g,e[a+5],4,-378558),l,d,e[a+8],11,-2022574463),E,l,e[a+11],16,1839030562),g,E,e[a+14],23,-35309556),d=s(d,g=s(g,E=s(E,l,d,g,e[a+1],4,-1530992060),l,d,e[a+4],11,1272893353),E,l,e[a+7],16,-155497632),g,E,e[a+10],23,-1094730640),d=s(d,g=s(g,E=s(E,l,d,g,e[a+13],4,681279174),l,d,e[a],11,-358537222),E,l,e[a+3],16,-722521979),g,E,e[a+6],23,76029189),d=s(d,g=s(g,E=s(E,l,d,g,e[a+9],4,-640364487),l,d,e[a+12],11,-421815835),E,l,e[a+15],16,530742520),g,E,e[a+2],23,-995338651),d=c(d,g=c(g,E=c(E,l,d,g,e[a],6,-198630844),l,d,e[a+7],10,1126891415),E,l,e[a+14],15,-1416354905),g,E,e[a+5],21,-57434055),d=c(d,g=c(g,E=c(E,l,d,g,e[a+12],6,1700485571),l,d,e[a+3],10,-1894986606),E,l,e[a+10],15,-1051523),g,E,e[a+1],21,-2054922799),d=c(d,g=c(g,E=c(E,l,d,g,e[a+8],6,1873313359),l,d,e[a+15],10,-30611744),E,l,e[a+6],15,-1560198380),g,E,e[a+13],21,1309151649),d=c(d,g=c(g,E=c(E,l,d,g,e[a+4],6,-145523070),l,d,e[a+11],10,-1120210379),E,l,e[a+2],15,718787259),g,E,e[a+9],21,-343485551),E=n(E,r),l=n(l,u),d=n(d,f),g=n(g,_);return[E,l,d,g]}function f(e){var t,n="",a=32*e.length;for(t=0;t<a;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function _(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var a=8*e.length;for(t=0;t<a;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function E(e){return f(u(_(e),8*e.length))}function l(e,t){var n,a,r=_(e),i=[],o=[];for(i[15]=o[15]=void 0,r.length>16&&(r=u(r,8*e.length)),n=0;n<16;n+=1)i[n]=909522486^r[n],o[n]=1549556828^r[n];return a=u(i.concat(_(t)),512+8*t.length),f(u(o.concat(a),640))}function d(e){var t,n,a="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),a+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return a}function g(e){return unescape(encodeURIComponent(e))}function h(e){return E(g(e))}function S(e){return d(h(e))}function p(e,t){return l(g(e),g(t))}function I(e,t){return d(p(e,t))}function y(e,t,n){return t?n?p(t,e):I(t,e):n?h(e):S(e)}e.exports?e.exports=y:t.md5=y}(commonjsGlobal)}),b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(e){for(var t={},n=0,a=e.length;n<a;n++)t[e.charAt(n)]=n;return t}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?fromCharCode(192|t>>>6)+fromCharCode(128|63&t):fromCharCode(224|t>>>12&15)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return fromCharCode(240|t>>>18&7)+fromCharCode(128|t>>>12&63)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(e){return e.replace(re_utob,cb_utob)},cb_encode=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[b64chars.charAt(n>>>18),b64chars.charAt(n>>>12&63),t>=2?"=":b64chars.charAt(n>>>6&63),t>=1?"=":b64chars.charAt(63&n)].join("")},btoa=function(e){return e.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=function(e){return btoa(utob(e))},encode=function(e,t){return t?_encode(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):_encode(String(e))},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return fromCharCode(55296+(t>>>10))+fromCharCode(56320+(1023&t));case 3:return fromCharCode((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return fromCharCode((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=function(e){return e.replace(re_btou,cb_btou)},cb_decode=function(e){var t=e.length,n=t%4,a=(t>0?b64tab[e.charAt(0)]<<18:0)|(t>1?b64tab[e.charAt(1)]<<12:0)|(t>2?b64tab[e.charAt(2)]<<6:0)|(t>3?b64tab[e.charAt(3)]:0),r=[fromCharCode(a>>>16),fromCharCode(a>>>8&255),fromCharCode(255&a)];return r.length-=[0,0,2,1][n],r.join("")},atob=function(e){return e.replace(/[\s\S]{1,4}/g,cb_decode)},_decode=function(e){return btou(atob(e))},decode=function(e){return _decode(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},base64={encode:encode,decode:decode},utils={MD5:MD5,encode:encode$1,decode:decode$1,checkEmptyArgument:checkEmptyArgument,checkId:checkId,isNumber:isNumber,checkMD5:checkMD5,compareVersion:compareVersion,getRandomStr:getRandomStr},udevice={getAlipaySystemInfoSync:function(){try{return alipay().my().getSystemInfoSync()}catch(e){ulog().err("获取SystemInfo异常")}},getSystemInfo:function(e,t){alipay().my().getSystemInfo({success:function(t){"function"==typeof e&&e(t)},fail:function(){"function"==typeof t&&t()}})},getDeviceInfo:function(e){try{alipay().my().call("getDeviceInfo",{},function(t){var n=(t||{}).data;if(n)cache().set(constants.DEVICE_INFO_KEY,n),"function"==typeof e&&e(n);else{var a=cache().get(constants.DEVICE_INFO_KEY);"function"==typeof e&&e(a)}})}catch(e){ulog().w("支付宝获取设备info 失败",e)}},getNetworkInfo:function(e,t){var n={success:function(t){"function"==typeof e&&e(t)},fail:function(){"function"==typeof t&&t()}};alipay().my().getNetworkType(n)},checkNetworkAvailable:function(e){alipay().my().getNetworkType({success:function(t){"function"==typeof e&&e(t.networkAvailable)},fail:function(){"function"==typeof e&&e(!1)}})},getDeviceId:function(e,t){"function"==typeof e&&e("")},getAdvertisingId:function(e,t){"function"==typeof e&&e("")},getUserId:function(e){try{alipay().my().call("getOpenUserData",{},function(t){(t||{}).uid||ulog().err('请确保已经勾选支付宝功能包中的"友盟+数据服务"功能包！'),"function"==typeof e&&e((t||{}).uid)})}catch(t){e("")}},getUniqueId:function(e){var t=cache().get("umeng_uniqueid");t?"function"==typeof e&&e(t):this._buildUniqueId(e)},getPageName:function(){},onNetworkStatusChange:function(e){alipay().my().onNetworkStatusChange(function(t){"function"==typeof e&&e(t.isConnected||!0)})},getFakeUniqueId:function(){var e=cache().get(constants.ALIPAY_FAKE_ID);return e||(e=this._buildFakeUniqueId()),e},_buildFakeUniqueId:function(){var e=constants.ALIPAYID_EMPTY_FLAGE+(new Date).getTime()+utils.getRandomStr(10);return cache().set(constants.ALIPAY_FAKE_ID,e),e},_buildUniqueId:function(e){var t=this;t.getDeviceId(function(n){t.getAdvertisingId(function(a){t.getUserId(function(t){var r=n||a||t;cache().set(constants.ADVERTISING_ID,a),cache().set(constants.ANDROID_ID,n),cache().set("umeng_uniqueid",r),e(r)})})})}},CLOSED_SESSIONS_KEY="closed_sessions",HALF_SESSIONS_KEY="half_sessions",CURRENT_SESSION_KEY="current_session",PAGE_END_TIME_KEY="page_endtime",Session=function(){function e(){return{trackPageStart:function(e){_.startPage(e)},trackPageEnd:function(e){_.endPage((o||{}).id,e)},getCurrentSessionId:function(){return(o||{}).id},getCurrentSession:function(){return o},getSessions:function(){return jsonUtil.parseToArray(cache().get(CLOSED_SESSIONS_KEY))},getHalfSessions:function(){return jsonUtil.parseToArray(cache().get(HALF_SESSIONS_KEY))},resume:function(e,t){c=e,u=t,n()},pause:function(){o&&(s=Date.now(),o.end_time=s,cache().set(CURRENT_SESSION_KEY,jsonUtil.stringify(o)),cache().set(PAGE_END_TIME_KEY,s))},clearSessions:function(){cache().remove(CLOSED_SESSIONS_KEY)},clearHalfSession:function(){cache().remove(HALF_SESSIONS_KEY)}}}function t(e){var t=Date.now();udevice.getUniqueId(function(n){var a=utils.MD5(t+":::"+c+":::"+n);e(a)})}function n(){var e=Date.now();if(o)s&&e-s>constants.SESSION_INTERVAL&&(a(s),r(o));else{var t=cache().get(CURRENT_SESSION_KEY);if(t)if(o=jsonUtil.parse(t)){var n=cache().get(PAGE_END_TIME_KEY);s=n,n&&e-n>constants.SESSION_INTERVAL&&(a(n),r(o))}else r(null);else r(null)}}function a(e){try{o.end_time=parseInt(e,10)}catch(t){o.end_time=e}var t=e-o.start_time;o.duration=t}function r(e){var n=e?e.id:"";t(function(t){if(o={id:t,start_time:Date.now()},cache().set(CURRENT_SESSION_KEY,jsonUtil.stringify(o)),e){var a=_.getPages(n);Array.isArray(a)&&a.length>0&&(e.pages=a,e.$page_num=a.length);var r=cache().get(CLOSED_SESSIONS_KEY),s=jsonUtil.parseToArray(r).concat(e);cache().set(CLOSED_SESSIONS_KEY,jsonUtil.stringify(s))}i()})}function i(){if(o){var e=cache().get(HALF_SESSIONS_KEY);e=jsonUtil.parseToArray(e).concat(o),cache().set(HALF_SESSIONS_KEY,jsonUtil.stringify(e)),"function"==typeof u&&u(o.id)}}var o,s,c="",u=null,f=null,_=new PageController;return{getInstance:function(){return f||(f=e()),f}}}(),uapp={getVersionName:function(){return""},getVersionCode:function(){return""},getSourceExtra:function(){return""},getPackageName:function(){return""}},MOBILE_NETWORK_2G="2g",MOBILE_NETWORK_3G="3g",MOBILE_NETWORK_4G="4g",MOBILE_NETWORK_NONE="none",BLANK_SPACE=" ",UMENG_ADVERTISTING_ID="idfa",UMENG_ANDROID_ID="android_id",Header=function(){function e(){function e(e,i){udevice.getSystemInfo(function(s){udevice.getUniqueId(function(c){udevice.getNetworkInfo(function(u){var f=u.type||u.networkType;f===MOBILE_NETWORK_NONE&&(f="unknown");var _=cache().get(constants.IMPRINT_KEY);_&&(o.imprint=_);var E=cache().get(constants.ADVERTISING_ID);if(E){var l=t(E);if(l){var d=n(UMENG_ADVERTISTING_ID,l);o.id_tracking=d}}var g=cache().get(constants.ANDROID_ID);if(g){var h=t(g);h&&(o.id_tracking&&o.id_tracking.snapshots?o.id_tracking.snapshots[UMENG_ANDROID_ID]=h:o.id_tracking=n(UMENG_ANDROID_ID,h))}a(e,s,c,f),r(s),i()})})})}function t(e){if(e)return{identity:e,version:1,ts:Date.now()}}function n(e,t){var n={snapshots:{}};return n.snapshots[e]=t,n}function a(e,t,n,a){if(o.app_version=uapp.getVersionName(),o.app_source_extra=uapp.getSourceExtra(),o.device_type="Phone",o.sdk_type="alipaymp",o.sdk_version=constants.IMPL_VERSION,o.appkey=e,n||"alipay"!==BuildTarget_1.ALIPAY||(n=s),o.idmd5=utils.MD5(n),o.pro_ver="1",t){var r,i,c,u=t.model,f=t.brand,_=f.toLowerCase();udevice.getUserId(function(e){o.alipay_id=e||s}),c=(r=t.screenWidth*t.pixelRatio)>(i=t.screenHeight*t.pixelRatio)?r+"*"+i:i+"*"+r,o.os=t.platform,o.font_size_setting=t.fontSizeSetting,o.device_model=u.toLowerCase().indexOf(_)>-1?u:_+BLANK_SPACE+u,o.device_brand=f,o.channel=_,o.device_manufacturer=_,o.device_manuid=u.toLowerCase().indexOf(_)>-1?u:_+BLANK_SPACE+u,o.device_name=u.toLowerCase().indexOf(_)>-1?u:_+BLANK_SPACE+u,o.os_version=t.system,o.resolution=c,o.language=t.language,o.alipay_version=t.version,o.platform="alipaymp",o.current_client="alipay",o.inner={sd:{t:t.storage,ts:Date.now()},by:[{le:t.currentBattery,ts:Date.now()}]}}switch(a){case MOBILE_NETWORK_4G:o.access_subtype="LTE",o.access="2G/3G";break;case MOBILE_NETWORK_3G:o.access_subtype="CDMA",o.access="2G/3G";break;case MOBILE_NETWORK_2G:o.access_subtype="GRPS",o.access="2G/3G";break;default:o.access=a,delete o.access_subtype}}function r(e){var t=[];e&&(t.push({name:"系统名",value:e.platform}),t.push({name:"支付宝版本号",value:e.version})),t.push({name:"设备型号",value:o.device_model}),t.push({name:"设备生产商",value:o.device_brand}),t.push({name:"os版本号",value:o.os_version}),t.push({name:"网络类型",value:o.access}),t.push({name:"运营商",value:o.access_subtype}),t.push({name:"分辨率",value:o.resolution});for(var n="",a=0;a<t.length;a++){var r=t[a];n+=r.name+": "+r.value+"; "}ulog().v("info: ",n)}var i=!1,o={},s=udevice.getFakeUniqueId();return{init:function(t){udevice.getUserId(function(n){udevice.getDeviceInfo(function(a){e(t,function(){i=!0,o.alipay_id=n||s,o.device_info=a||""})})})},isLoaded:function(){return i},get:function(e){switch(e){case constants.REQUEST_TYPE_SESSION_HALF:o.st="1";break;case constants.REQUEST_TYPE_SESSION_CLOSE:case constants.REQUEST_TYPE_EVENT:o.st&&delete o.st}return JSON.parse(JSON.stringify(o))},setItem:function(e,t){o[e]=t},getItem:function(e){return o[e]},updateExtraInfo:function(){udevice.getDeviceInfo(function(e){o.device_info=e||""})}}}var t=null;return{getInstance:function(){return t||(t=e()),t}}}(),EKVS_KEY="ekvs",EVENT_MAX_COUNT=1e4,MEMORY_DATA_COUNT=1,EventManager=function(){function e(e,t){var n={id:e,ts:Date.now()};switch(typeof t){case"string":n[e]=t;break;case"object":for(var a in t)({}).hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n}function t(e){if(e){if(!Session.getInstance().getCurrentSessionId())return ulog().w("session id is null"),void u.unshift(e);c.unshift(e),c.length>=MEMORY_DATA_COUNT&&a()}}function n(e){var t=0;return e.forEach(function(e){for(var n in e)e[n]&&(t+=e[n].length)}),t}function a(){if(c.length){var e=jsonUtil.parseToArray(cache().get(EKVS_KEY));if(n(e)+c.length<=EVENT_MAX_COUNT){var t=i(e,c);cache().set(EKVS_KEY,jsonUtil.stringify(t))}c.length=0}}function r(e){t(e)}function i(e,t){for(var n=Session.getInstance().getCurrentSessionId(),a=0,r=[];a<e.length&&!(r=e[a][n]);a++);if(Array.isArray(r)&&r.length)e[a][n]=r.concat(t);else{var i={};i[n]=t,e.push(i)}return e}function o(){this.readEkvs=function(){var e=[],t=cache().get(EKVS_KEY);if(t){var n=jsonUtil.parseToArray(t);e=c&&c.length?i(n,c):n}return e},this.clearEkvs=function(){cache().remove(EKVS_KEY),c.length=0},this.addEvent=function(t,n){r(e(t,n))},this.addSessionId=function(){var e=Session.getInstance().getCurrentSessionId();if(Array.isArray(u)&&u.length&&e){for(var t=0;t<u.length;t++)r(u[t]);u.length=0}},this.quit=function(){if(c.length){var e=cache().get(EKVS_KEY),t=i(jsonUtil.parseToArray(e),c);cache().set(EKVS_KEY,jsonUtil.stringify(t)),c.length=0}}}var s,c=[],u=[];return{getInstance:function(){return s||(s=new o),s}}}(),RequestHelper=function(){function e(e){var t="";switch(e){case constants.REQUEST_TYPE_SESSION_HALF:t=constants.HALF_SESSION_PREFIX_KEY;break;case constants.REQUEST_TYPE_SESSION_CLOSE:t=constants.CLOSE_SESSION_PREFIX_KEY;break;case constants.REQUEST_TYPE_EVENT:t=constants.EVENT_PREFIX_KEY}return t}function t(){return{isParamsValid:function(e){return-1!==[constants.REQUEST_TYPE_SESSION_HALF,constants.REQUEST_TYPE_SESSION_CLOSE,constants.REQUEST_TYPE_EVENT].indexOf(e)},buildSendContent:function(t){if(Header.getInstance().get(t)){var n={header:Header.getInstance().get(t),analytics:null};switch(t){case constants.REQUEST_TYPE_SESSION_HALF:var a=Session.getInstance().getHalfSessions();a&&a.length&&(Session.getInstance().clearHalfSession(),n.analytics={sessions:a});break;case constants.REQUEST_TYPE_SESSION_CLOSE:var r=Session.getInstance().getSessions();r&&r.length&&(Session.getInstance().clearSessions(),n.analytics={sessions:r});break;case constants.REQUEST_TYPE_EVENT:var i=EventManager.getInstance().readEkvs();Array.isArray(i)&&i.length&&(EventManager.getInstance().clearEkvs(),n.analytics={ekv:i})}var o="";if(n.analytics){var s=jsonUtil.stringify(n);o=e(t)+utils.MD5(s)}return{data:n,key:o}}}}}var n;return{getInstance:function(){return n||(n=t()),n}}}();Looper.prototype={prepare:function(e){this._queue=e,this._running=!1,this._forceStop=!1},run:function(){if(!this._forceStop){if(!this._queue)return void ulog().w("requestQueue is null");if(!this._running)for(this._running=!0;this._running;)try{this._queue.dispatchMessage()}catch(e){}}},wait:function(){this._running=!1},forceStop:function(){this._forceStop=!0},cancelForceStop:function(){this._forceStop=!1,this.run()}};var MAX_REQUEST_COUNT=1,MAX_FAIL_COUNT=5,requestQueue=function(){function e(e,a){var r=e.key,i=jsonUtil.stringify(e.data),o=e.success,s=e.fail;ulog().i("开始发送数据"),urequest({url:constants.LOG_URL,method:"POST",data:utils.encode(i),headers:{"Content-Type":"alipaymp/json","Msg-Type":"alipaymp/json"},success:function(a){var c=a.code||a.status;200===c||413===c?(ulog().i("数据发送成功: ",c),d=0,t((a.data||{}).imprint),"function"==typeof o&&o(r)):(n(e),"function"==typeof s&&s(r,i))},fail:function(t){ulog().w("数据发送失败: ",t),d+=1,n(e),"function"==typeof s&&s(r,i)},complete:function(){"function"==typeof a&&a(r)}})}function t(e){try{if(e){cache().set(constants.IMPRINT_KEY,e),Header.getInstance().setItem("imprint",e);var t=jsonUtil.parse(utils.decode(e)),n=t.report_policy;if(n&&utils.isNumber(n)&&(cache().set(constants.REPORT_POLICY,n),n===constants.REPORT_POLICY_INTERVAL)){var a=t.report_interval;a&&utils.isNumber(a)&&(a<=constants.EVENT_SEND_MIN_INTERVAL?a=constants.EVENT_SEND_MIN_INTERVAL:a>constants.EVENT_SEND_MAX_INTERVAL&&(a=constants.EVENT_SEND_MAX_INTERVAL),cache().set(constants.REPORT_INTERVAL_TIME,a))}}}catch(e){}}function n(e){E.unshift(e)}function a(){return cache().get(constants.NO_SEND_REQUESTS_KEY)||[]}function r(){cache().set(constants.NO_SEND_REQUESTS_KEY,[].concat(E))}function i(e,t){return e.concat(t)}function o(e,t){for(var n=0;n<t.length;n++)for(var a in t[n])e[a]?e[a]=e[a].concat(t[n][a]):e[a]=t[n][a];return e}function s(e){var t=[],n=[],a={},r={},s={},c={},u={},f={};if(e.length){for(var _=0;_<e.length;_++){var E=e[_].data;switch(e[_].key.split("_")[0]+"_"){case constants.HALF_SESSION_PREFIX_KEY:t=i(t,E.analytics.sessions),r.key=e[_].key,u=E.header;break;case constants.EVENT_PREFIX_KEY:a=o(a,E.analytics.ekv),c.key=e[_].key,f=E.header;break;case constants.CLOSE_SESSION_PREFIX_KEY:n=i(n,E.analytics.sessions),s.key=e[_].key}}r.data={header:u,analytics:{sessions:t}},s.data={header:f,analytics:{sessions:n}},c.data={header:f,analytics:{ekv:[a]}}}return{mergedHalfSessions:r,mergedCloseSessions:s,mergedEkvs:c}}function c(e){var t=s(e),n=[];for(var a in t)t[a].key&&n.push(t[a]);return n}function u(){this.send=function(e,t,n){e&&e.key&&e.data&&e.data.analytics&&(e.success=t,e.fail=n,E.unshift(e),d>=MAX_FAIL_COUNT&&(d-=1),_.run())},this.dispatchMessage=function(){if(l>=MAX_REQUEST_COUNT||!g||d>=MAX_FAIL_COUNT)return void _.wait();var t=E.pop();t&&t.key&&t.data?(l+=1,e(t,function(){l-=1,_.run()})):_.wait()},this.resume=function(){var e=a();e=c(e),E=E.concat(e)},this.pause=function(){r(),E.length=0,_.wait()}}var f,_,E=[],l=0,d=0,g=!0;return{getInstance:function(){return f||(f=new u,(_=new Looper).prepare(f)),f}}}(),Request={send:send,sendAll:sendAll};UmengAnalysisLib.prototype={init:function(e,t,n){if(ulog().v("sdk version: "+constants.IMPL_VERSION),this._inited)return void ulog().v("Lib重复实例化");if(!e)return this._inited=!1,void ulog().err("appkey不能为空，请确保传入正确的appkey");var a=this;cache().load(function(){ulog().v("cache加载成功"),a._init(e,t),a._inited=!0,"function"==typeof n&&n(),ulog().tip("SDK集成成功")})},_init:function(e){Header.getInstance().init(e),ulog().v("Header初始化成功"),requestQueue.getInstance(),ulog().v("请求队列初始化成功"),this._bindAuthChange(),this._handleQuit()},_bindAuthChange:function(){try{alipay().my().on("alipayAuthChange",function(e){e&&e.data&&e.data.authcode&&Header.getInstance().updateExtraInfo()})}catch(e){ulog().e("绑定auth change异常: ",e)}},_handleQuit:function(){},_sendPolicy:function(){var e=cache().get(constants.REPORT_POLICY);if(e&&e===constants.REPORT_POLICY_INTERVAL){var t=cache().get(constants.REPORT_INTERVAL_TIME),n=cache().get(constants.EVENT_LAST_SEND_TIME_KEY),a=!n;if(t=t||constants.EVENT_SEND_MIN_INTERVAL,a=a||Date.now()-n>1e3*t){var r=this;r._updateLastSendTime(),Request.send(constants.REQUEST_TYPE_EVENT,null,function(){r._recoverLastSendTime()})}}},_updateLastSendTime:function(){this._preLastSendTime=cache().get(constants.EVENT_LAST_SEND_TIME_KEY),cache().set(constants.EVENT_LAST_SEND_TIME_KEY,Date.now())},_recoverLastSendTime:function(){cache().set(constants.EVENT_LAST_SEND_TIME_KEY,this._preLastSendTime)},resume:function(e){this._inited&&!this._resumed&&(this._resumed=!0,e&&this.trackPageStart(e),requestQueue.getInstance().resume(),Session.getInstance().resume(this.appkey,function(e){ulog().v("创建新会话: "+e),EventManager.getInstance().addSessionId(),Request.sendAll()}))},pause:function(e){this._inited&&this._resumed&&(this._resumed=!1,e&&this.trackPageEnd(e),requestQueue.getInstance().pause(),Session.getInstance().pause(),EventManager.getInstance().quit(),cache().save(),ulog().v("退出会话"))},trackEvent:function(e,t){if(this._inited){if(!utils.checkId(e))return void ulog().e("event id should be string and can not be null");if(t&&"[object Object]"!==Object.prototype.toString.call(t)&&"[object String]"!==Object.prototype.toString.call(t))return void ulog().e("please check trackEvent attr. attr should be string or object(not include Array)");ulog().v("event id: "+jsonUtil.stringify(e)+(t?" || event attr: "+jsonUtil.stringify(t):"")),EventManager.getInstance().addEvent(e,t),this._sendPolicy()}},trackPageStart:function(e){this._inited&&Session.getInstance().trackPageStart(e)},trackPageEnd:function(e){this._inited&&Session.getInstance().trackPageEnd(e)}};export default UmengAnalysisLib;
